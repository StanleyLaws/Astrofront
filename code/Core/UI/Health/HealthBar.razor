@using Sandbox
@using Sandbox.UI
@using System.Linq
@inherits Panel
@namespace Astrofront

@if ( Local is not null && Local.MaxHealth > 0 )
{
    <div class="hud-root">
        <div class="hp">
            <div class="hp-fill" style="width: @(Local.HealthFraction * 100f)%"></div>
        </div>
    </div>
}

@code 
{
    private PlayerState _cached;

    private PlayerState Local
    {
        get
        {
            if ( _cached != null && _cached.IsValid ) return _cached;

            _cached = Scene.GetAllComponents<PlayerState>()
                .FirstOrDefault( p => !p.IsProxy );

            return _cached;
        }
    }

    protected override int BuildHash()
    {
        if ( Local is null ) return -1;
        return (Local.Health * 397) ^ Local.MaxHealth;
    }
}
